Refactor ObjectEncoding to improve type handling